<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Registro - Crear cuenta</title>
<link rel="stylesheet" href="../css/register.css">
</head>
<body>
  <form class="card" id="registerForm" novalidate>
    <h1>Crear cuenta</h1>



    <div class="field">
      <label for="username">Nombre de usuario</label>
      <input id="username" name="username" type="text" placeholder="ej: juan.perez" required minlength="3" maxlength="30" pattern="^[A-Za-z0-9._-]{3,30}$">
      <div class="error" id="err-username"></div>
    </div>

    <div class="field">
      <label for="password">Contraseña</label>
      <div style="display:flex;gap:8px">
        <input id="password" name="password" type="password" placeholder="Mín. 8 caracteres" required minlength="8">
        <button type="button" class="show-toggle" id="togglePw">Mostrar</button>
      </div>
      <div class="pw-strength muted" id="pwStrength">Recomendado: al menos 8 caracteres, incluir mayúscula y número.</div>
      <div class="error" id="err-password"></div>
    </div>

    <div class="field">
      <label for="password2">Repetir contraseña</label>
      <input id="password2" name="password2" type="password" placeholder="Repite tu contraseña" required>
      <div class="error" id="err-password2"></div>
    </div>

    <div class="field">
      <label for="dob">Fecha de nacimiento</label>
      <input id="dob" name="dob" type="date" required>
      <div class="error" id="err-dob"></div>
    </div>

    <div class="field">
      <label for="doc">Número de documento</label>
      <input id="doc" name="doc" type="text" placeholder="DNI / Pasaporte" required pattern="^[0-9A-Za-z-]{6,15}$">
      <div class="error" id="err-doc"></div>
    </div>

    <div class="field">
      <label for="address">Domicilio</label>
      <input id="address" name="address" type="text" placeholder="Calle 123, Barrio, Ciudad" >
      <div class="error" id="err-address"></div>
    </div>

    <div class="field inline">
      <input id="terms" name="terms" type="checkbox" required>
      <label for="terms" class="muted" style="font-weight:400">Acepto las <a href="#" class="link">Condiciones de servicio</a> y la <a href="#" class="link">Política de privacidad</a>.</label>
    </div>
    <div class="error" id="err-terms"></div>

    <div style="margin-top:12px">
      <button class="btn" type="submit">Crear cuenta</button>
    </div>

    <p class="muted" style="text-align:center;margin-top:12px">¿Ya tienes cuenta? <a class="link" href="#">Iniciar sesión</a></p>
  </form>

<script>
  const form = document.getElementById('registerForm');
  const togglePw = document.getElementById('togglePw');
  const pw = document.getElementById('password');
  const pw2 = document.getElementById('password2');
  const pwStrength = document.getElementById('pwStrength');

  togglePw.addEventListener('click', () => {
    const t = pw.type === 'password' ? 'text' : 'password';
    pw.type = t; pw2.type = t;
    togglePw.textContent = t === 'text' ? 'Ocultar' : 'Mostrar';
  });

  function checkPasswordStrength(p) {
    let score = 0;
    if (p.length >= 8) score++;
    if (/[A-Z]/.test(p)) score++;
    if (/[0-9]/.test(p)) score++;
    if (/[^A-Za-z0-9]/.test(p)) score++;
    return score; // 0-4
  }

  pw.addEventListener('input', () => {
    const s = checkPasswordStrength(pw.value);
    const msgs = ['Muy débil','Débil','Aceptable','Buena','Fuerte'];
    pwStrength.textContent = 'Fuerza: ' + msgs[s];
  });

  function showError(id, message){ document.getElementById(id).textContent = message;}
  function clearErrors(){ ['err-email','err-username','err-password','err-password2','err-dob','err-doc','err-terms','err-address'].forEach(id=>showError(id,'')); }

  function calcularEdad(fecha) {
    const hoy = new Date();
    const f = new Date(fecha);
    let edad = hoy.getFullYear() - f.getFullYear();
    const m = hoy.getMonth() - f.getMonth();
    if (m < 0 || (m === 0 && hoy.getDate() < f.getDate())) edad--;
    return edad;
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    clearErrors();
    let ok = true;

    // Email simple
    const email = form.email.value.trim();
    if (!email || !/^\S+@\S+\.\S+$/.test(email)) { showError('err-email','Introduce un correo válido.'); ok=false; }

    // Username
    const username = form.username.value.trim();
    if (!username || username.length < 3) { showError('err-username','El nombre de usuario debe tener al menos 3 caracteres.'); ok=false; }

    // Password
    if (pw.value.length < 8) { showError('err-password','La contraseña debe tener al menos 8 caracteres.'); ok=false; }
    if (pw.value !== pw2.value) { showError('err-password2','Las contraseñas no coinciden.'); ok=false; }

    // Fecha nacimiento: al menos 13 años
    const dob = form.dob.value;
    if (!dob || calcularEdad(dob) < 13) { showError('err-dob','Debes tener al menos 13 años.'); ok=false; }

    // Documento
    if (!form.doc.value.trim()) { showError('err-doc','Introduce tu número de documento.'); ok=false; }

    // Terms
    if (!form.terms.checked) { showError('err-terms','Debes aceptar las Condiciones de servicio.'); ok=false; }

    if (!ok) return;

    // Aquí enviarías los datos al servidor (fetch / axios) — con validación adicional en backend.
    alert('Formulario válido. Enviar datos al servidor.');
  });
</script>
</body>
</html>

