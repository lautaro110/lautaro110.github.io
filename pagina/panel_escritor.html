<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="icon" type="image/png" href="../img_logo/logo-tecnica.png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel del Escritor</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="../css/navegador.css">
  <link rel="stylesheet" href="../css/panel_escritor.css">
  <link rel="stylesheet" href="../css/noticias.css">
  <link rel="stylesheet" href="../css/calendario.css">

  <!-- Scripts -->
  <script>
    // Stub para evitar condiciones de carrera: encola llamadas a cargarEventos
    (function(){
      if (!window._calendario_queue) window._calendario_queue = [];
      if (!window.cargarEventos) {
        window.cargarEventos = function(mine){ window._calendario_queue.push(!!mine); };
      }
    })();
  </script>
  <script src="../js/navbar.js" defer></script>
  <script src="../js/login.js" defer></script>
  <script src="../js/panel_escritor.js" defer></script>
  <script src="../js/editor-enhancements.js" defer></script>
  <script src="../js/editor-enhancements.js" defer></script>
  <script src="../js/calendario.js" defer></script>
</head>

<body>
<header class="navegador">
  <div class="logo">
    <h1><a href="../index.html">E.E.S.T. Nro 5 - "Gral. Manuel N. Savio</a></h1>
  </div>
  <div class="buscador oculto">
    <input type="text" id="buscarNoticias" placeholder="Buscar noticias...">
    <button id="btnBuscar">üîç</button>
  </div>
  <nav id="navPrincipal" class="navbar"></nav>
</header>

<main class="panel-main">
  <!-- BOTONES PARA ALTERNAR NOTICIA / CALENDARIO -->
  <div id="toggleBotones" class="toggle-botones" style="display:flex;justify-content:center;gap:10px;margin:15px 0;"></div>

  <!-- CONTENIDO NOTICIAS -->
  <section class="editor-container" id="contenidoNoticias">
    <h2>üñãÔ∏è Crear Nueva Noticia</h2>
    <div id="mensajeContainer"></div>

    <!-- SIN onsubmit, que lo maneje panel_escritor.js -->
    <form id="formNoticia">
      <label for="tituloNoticia">T√≠tulo de la noticia</label>
      <input type="text" id="tituloNoticia" name="titulo" placeholder="Ej: Jornada de Puertas Abiertas" required>

      <input type="hidden" id="autorNoticia" name="autor">
      <input type="hidden" id="fechaNoticia" name="fecha">

      <label for="imagenNoticia">Imagen destacada (opcional)</label>
      <!-- Debe tener type="file" (NO type="text") -->
      <input type="file" id="imagenNoticia" name="imagen" accept="image/*">
      <img id="previewImagen" alt="Vista previa">

      <!-- Tipo de noticia: principal o secundaria -->
      <div class="tipo-noticia-control" style="margin:10px 0;">
        <label style="display:block; font-weight:600; margin-bottom:6px;">Tipo de noticia</label>
        <label style="margin-right:12px;"><input type="radio" name="tipoNoticia" value="principal"> Principal</label>
        <label><input type="radio" name="tipoNoticia" value="secundaria" checked> Secundaria</label>
      </div>

      <div class="editor-toolbar" role="toolbar" aria-label="Barra de herramientas de edici√≥n">
        <button type="button" data-cmd="bold" title="Negrita"><b>B</b></button>
        <button type="button" data-cmd="italic" title="Cursiva"><i>I</i></button>
        <button type="button" data-cmd="underline" title="Subrayado"><u>U</u></button>

        <select id="fontSizeSelect" title="Tama√±o de fuente">
          <option value="">Tama√±o</option>
          <option value="1">Peque√±o</option>
          <option value="3" selected>Normal</option>
          <option value="5">Grande</option>
          <option value="7">Muy grande</option>
        </select>

        <button type="button" data-cmd="justifyleft" title="Alinear a la izquierda">‚ü∏</button>
        <button type="button" data-cmd="justifycenter" title="Centrar">‚â°</button>
        <button type="button" data-cmd="justifyright" title="Alinear a la derecha">‚üπ</button>

        <button type="button" id="insertLinkBtn" title="Insertar enlace">üîó</button>
        <input type="file" id="insertImageFile" accept="image/*" style="display:none;">
        <button type="button" id="insertImageBtn" title="Insertar imagen">üñºÔ∏è</button>
      </div>

      <div id="editor" class="editor" contenteditable="true" placeholder="Escribe el contenido de la noticia aqu√≠..." aria-label="Editor de contenido"></div>

      <div style="background: #f0f8ff; padding: 10px; border-radius: 6px; margin-bottom: 1rem; font-size: 0.95rem; color: #333;">
        <strong>üí° Ayuda r√°pida ‚Äî ¬øQu√© hace cada control?</strong>
        <ul style="margin: 8px 0; padding-left: 20px;">
          <li><strong>B</strong>: Aplica <em>negrita</em> al texto seleccionado.</li>
          <li><strong>I</strong>: Aplica <em>cursiva</em> al texto seleccionado.</li>
          <li><strong>U</strong>: Aplica <em>subrayado</em> al texto seleccionado.</li>
          <li><strong>Tama√±o</strong>: Cambia el tama√±o del texto seleccionado. Si hay una imagen seleccionada, ajusta el <em>ancho</em> de la imagen (25% / 50% / 75% / 100%).</li>
          <li><strong>‚ü∏</strong>: Alinea a la <em>izquierda</em>. Si tienes una imagen seleccionada, la sit√∫a a la izquierda y el texto la rodea.</li>
          <li><strong>‚â°</strong>: Centra. Si tienes una imagen seleccionada, la centra dentro del contenedor.</li>
          <li><strong>‚üπ</strong>: Alinea a la <em>derecha</em>. Si tienes una imagen seleccionada, la sit√∫a a la derecha y el texto la rodea.</li>
          <li><strong>üîó</strong>: Insertar enlace: selecciona texto y pulsa para a√±adir una URL.</li>
          <li><strong>üñºÔ∏è</strong>: Insertar imagen desde tu dispositivo. Haz clic en la imagen para seleccionarla (se resaltar√° en azul), y luego usa los botones de alineaci√≥n o el selector de tama√±o para moverla o cambiar su ancho.</li>
        </ul>
        <div style="margin-top:6px;color:#555;font-size:0.88rem">Consejo: Para mover una imagen primero haz <strong>clic</strong> sobre ella (ver√°s un borde azul), luego pulsa el bot√≥n de la barra para colocarla a la izquierda/derecha/centro o usa el selector de tama√±o para ajustar su ancho.</div>
      </div>

      <div class="botones-editor">
        <button type="submit" class="btn-primario">üì¢ Publicar Noticia</button>
      </div>
    </form>
  </section>

  <!-- MIS NOTICIAS -->
  <section class="mis-noticias">
    <h2>üì∞ Mis Noticias Publicadas</h2>
    <div id="listaNoticias" class="noticias-grid">
      <p class="placeholder">Todav√≠a no has publicado ninguna noticia.</p>
    </div>
  </section>

  <!-- CALENDARIO -->
  <section class="calendario-container" id="calendarioContainer" style="display:none;">
    <h2>üìÖ Agregar Evento al Calendario</h2>
    <div class="calendario-mes">
      <div id="calendarHeader" class="calendar-header">
        <button id="prevMonth">‚óÄ</button>
        <span id="monthYear"></span>
        <button id="nextMonth">‚ñ∂</button>
      </div>
      <table id="calendarTable">
        <thead>
          <tr>
            <th>Lun</th><th>Mar</th><th>Mi√©</th><th>Jue</th><th>Vie</th><th>S√°b</th><th>Dom</th>
          </tr>
        </thead>
        <tbody id="calendarBody"></tbody>
      </table>
    </div>

    <!-- FORMULARIO DE EVENTO -->
    <form id="formEvento" class="calendario-form">
      <input type="text" id="tituloEvento" placeholder="T√≠tulo del evento" required>
      <select id="tipoEvento" required>
        <option value="">Seleccionar tipo de evento</option>
        <option value="titulo-feriado">D√≠a Feriado</option>
        <option value="titulo-no-clases">No hay clases</option>
        <option value="titulo-evento">Evento importante</option>
      </select>

      <!-- INPUT DE FECHA CORREGIDO -->
      <label>Fecha del evento:</label>
      <input type="date" id="fechaEvento" required>

      <label>Hora inicio:</label>
      <input type="time" id="horaInicio" required>
      <label>Hora fin:</label>
      <input type="time" id="horaFin" required>
      <label>Descripci√≥n:</label>
      <textarea id="descripcionEvento" placeholder="Descripci√≥n del evento"></textarea>

      <div class="botones-form">
        <button type="submit" class="btn-primario">Guardar Evento</button>
        <button type="button" class="btn-secundario" onclick="ocultarFormularioEvento()">Cancelar</button>
      </div>
    </form>

    <h3>Eventos existentes</h3>
    <div id="eventosContainer"></div>
  </section>
</main>

<footer>¬© 2025 Escuela T√©cnica - La Plata</footer>

<!-- El script de manejo del formulario est√° en ../js/panel_escritor.js -->
<script>
  // Si queremos que en la secci√≥n "Eventos existentes" se muestren solo los eventos subidos por el usuario
  // llamamos a la funci√≥n global `cargarEventos(true)` que fue exportada por `js/calendario.js`.
  document.addEventListener('DOMContentLoaded', function() {
    try {
      if (window.cargarEventos) {
        // cargar solo los eventos del usuario en sesi√≥n
        window.cargarEventos(true);
      }
    } catch (e) {
      console.error('No se pudo cargar eventos con filtro mine:', e);
    }
  });
</script>
</body>
</html>
